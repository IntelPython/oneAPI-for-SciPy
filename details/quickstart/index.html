<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.101.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/oneAPI-for-SciPy/favicons/favicon.ico><link rel=apple-touch-icon href=/oneAPI-for-SciPy/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/oneAPI-for-SciPy/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/oneAPI-for-SciPy/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/oneAPI-for-SciPy/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/oneAPI-for-SciPy/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/oneAPI-for-SciPy/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/oneAPI-for-SciPy/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/oneAPI-for-SciPy/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/oneAPI-for-SciPy/favicons/android-192x192.png sizes=192x192><title>Quickstart | oneAPI for SciPy</title><meta name=description content="Get started with oneAPI Python-extensions
"><meta property="og:title" content="Quickstart"><meta property="og:description" content="Get started with oneAPI Python-extensions
"><meta property="og:type" content="article"><meta property="og:url" content="https://IntelPython.github.io/oneAPI-for-SciPy/details/quickstart/"><meta property="article:section" content="details"><meta property="article:published_time" content="2022-06-14T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-30T16:36:58-05:00"><meta itemprop=name content="Quickstart"><meta itemprop=description content="Get started with oneAPI Python-extensions
"><meta itemprop=datePublished content="2022-06-14T00:00:00+00:00"><meta itemprop=dateModified content="2022-06-30T16:36:58-05:00"><meta itemprop=wordCount content="966"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Quickstart"><meta name=twitter:description content="Get started with oneAPI Python-extensions
"><link rel=preload href=/oneAPI-for-SciPy/scss/main.min.04b151beccbf4ac02d79f0b15e74ad3db29ff903370abdffbd69dd7a531dbc0f.css as=style><link href=/oneAPI-for-SciPy/scss/main.min.04b151beccbf4ac02d79f0b15e74ad3db29ff903370abdffbd69dd7a531dbc0f.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-00000000-0","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/oneAPI-for-SciPy/><span class=navbar-logo></span><span class=font-weight-bold>oneAPI for SciPy</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/oneAPI-for-SciPy/about/><span>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/oneAPI-for-SciPy/details/><span class=active>Details</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-oneapi-for-scipydetails-li><a href=/oneAPI-for-SciPy/details/ title="SciPy 2022 virtual poster" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-oneapi-for-scipydetails><span>Details</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-oneapi-for-scipydetailsquickstart-li><a href=/oneAPI-for-SciPy/details/quickstart/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-oneapi-for-scipydetailsquickstart><span class=td-sidebar-nav-active-item>Quickstart</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-oneapi-for-scipydetailsoneapi-li><a href=/oneAPI-for-SciPy/details/oneapi/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-oneapi-for-scipydetailsoneapi><span>What is oneAPI</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-oneapi-for-scipydetailsinstall_oneapi-li><a href=/oneAPI-for-SciPy/details/install_oneapi/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-oneapi-for-scipydetailsinstall_oneapi><span>Install Intel(R) oneAPI toolkits</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-oneapi-for-scipydetailsskbuild-li><a href=/oneAPI-for-SciPy/details/skbuild/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-oneapi-for-scipydetailsskbuild><span>oneAPI Python extensions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-oneapi-for-scipydetailswhy-li><a href=/oneAPI-for-SciPy/details/why/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-oneapi-for-scipydetailswhy><span>Why use oneAPI in Python</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/IntelPython/oneAPI-for-SciPy/tree/main/content/en/details/quickstart.md class=td-page-meta--view target=_blank rel=noopener><i class="fa fa-file-alt fa-fw"></i> View page source</a>
<a href=https://github.com/IntelPython/oneAPI-for-SciPy/edit/main/content/en/details/quickstart.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/IntelPython/oneAPI-for-SciPy/new/main/content/en/details/quickstart.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/IntelPython/oneAPI-for-SciPy/issues/new?title=Quickstart" class=td-page-meta--issue target=_blank rel=noopener><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a id=print href=https://IntelPython.github.io/oneAPI-for-SciPy/details/_print/><i class="fa fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><ul><li><a href=#recognizing-available-devices>Recognizing available devices</a></li><li><a href=#specifying-offload-target>Specifying offload target</a></li><li><a href=#data-sharing>Data sharing</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><h1>Quickstart</h1><div class=lead>Get started with oneAPI Python-extensions</div><header class=article-meta></header><p>In a heterogeneous system there may be <strong>multiple</strong> devices a Python user may want to engage.
For example, it is common for a consumer-grade laptop to feature an integrated or a discrete
GPU alongside a CPU.</p><p>To harness their power one needs to know how to answer the following 3 key questions:</p><ol><li>How does a Python program recognize available computational devices?</li><li>How does a Python workload specify computations to be offloaded to selected devices?</li><li>How does a Python application manage data sharing?</li></ol><h3 id=recognizing-available-devices>Recognizing available devices</h3><p>Python package <code>dpctl</code> answers these questions. All the computational devices known to the
underlying DPC++ runtime can be accessed using <code>dpctl.get_devices()</code>. A specific device of
interest <a href=https://intelpython.github.io/dpctl/latest/docfiles/user_guides/manual/dpctl/device_selection.html>can be selected</a> either using a helper function,
e.g. <code>dpctl.select_gpu_device()</code>, or by passing a filter selector string
to <code>dpctl.SyclDevice</code> constructor.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>dpctl</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># select a GPU device. If multiple devices present, </span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># let the underlying runtime select from GPUs</span>
</span></span><span style=display:flex><span><span style=color:#000>dev_gpu</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dpctl</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>SyclDevice</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;gpu&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># select a CPU device</span>
</span></span><span style=display:flex><span><span style=color:#000>dev_cpu</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dpctl</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>SyclDevice</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;cpu&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># stand-alone function, equivalent to C++ </span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   `auto dev = sycl::gpu_selector().select_device();`</span>
</span></span><span style=display:flex><span><span style=color:#000>dev_gpu_alt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dpctl</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>select_gpu_device</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># stand-alone function, equivalent to C++ </span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   `auto dev = sycl::cpu_selector().select_device();`</span>
</span></span><span style=display:flex><span><span style=color:#000>dev_cpu_alt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dpctl</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>select_cpu_device</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>A <a href=https://intelpython.github.io/dpctl/latest/docfiles/user_guides/manual/dpctl/devices.html>device object</a> can be used to query properies of the device, such as its name, vendor, maximal number of computational units, memory size, etc.</p><h3 id=specifying-offload-target>Specifying offload target</h3><p>To answer the second question on the list we need a digression to explain offloading in DPC++ first. A computational task is offloaded for execution on a device
by submitting it to DPC++ runtime which inserts the task in a computational graph. Once the device becomes available the runtime selects a task whose dependencies
are met for execution.</p><p>The computational graph along with the device targeted by its tasks are stored in a <a href=https://intelpython.github.io/dpctl/latest/docfiles/user_guides/manual/dpctl/queues.html>SYCL queue</a> object. The task submission is therefore always
associated with a queue.</p><p>Queues can be constructed directly from a device object, or by using a filter selector string to indicate the device to construct:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic># construct queue from device object</span>
</span></span><span style=display:flex><span><span style=color:#000>q1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dpctl</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>SyclQueue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dev_gpu</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># construct queue using filter selector</span>
</span></span><span style=display:flex><span><span style=color:#000>q2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dpctl</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>SyclQueue</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;gpu&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>The computational tasks can be stored in an oneAPI native extension in which case their submission is orchestrated
during Python API calls. Let&rsquo;s consider a function that offloads an evaluation of a polynomial for every point of a
NumPy array <code>X</code>. Such a function needs to receive a queue object to indicate which device the computation must be
offloaded too:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic># allocate space for the result</span>
</span></span><span style=display:flex><span><span style=color:#000>Y</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>empty_like</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># evaluate polynomial on the device targeted by the queue, Y[i] = p(X[i])</span>
</span></span><span style=display:flex><span><span style=color:#000>onapi_ext</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>offloaded_poly_evaluate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>q</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Y</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Python call to <code>onapi_ext.offloaded_poly_evaluate</code> of NumPy arrays of double precision floating pointer numbers gets
translated to the following sample C++ code:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#204a87;font-weight:700>void</span> 
</span></span><span style=display:flex><span><span style=color:#000>cpp_offloaded_poly_evaluate</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>  <span style=color:#000>sycl</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>queue</span> <span style=color:#000>q</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>double</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>double</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Y</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>size_t</span> <span style=color:#000>n</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>    
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// create buffers from malloc allocations to make data accessible from device
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>sycl</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>buffer</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>double</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>buf_X</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>sycl</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>buffer</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>double</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>buf_Y</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Y</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>q</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>submit</span><span style=color:#000;font-weight:700>([</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000;font-weight:700>](</span><span style=color:#000>sycl</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>handler</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>cgh</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// create buffer accessors indicating kernel data-flow pattern  
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>sycl</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>accessor</span> <span style=color:#000>acc_X</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>buf_X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>cgh</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sycl</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>read_only</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>sycl</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>accessor</span> <span style=color:#000>acc_Y</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>buf_Y</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>cgh</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sycl</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>write_only</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sycl</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>no_init</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>cgh</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>parallel_for</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>           <span style=color:#8f5902;font-style:italic>// lambda function that gets executed by different work-items with 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>           <span style=color:#8f5902;font-style:italic>// different arguments in parallel
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>           <span style=color:#000;font-weight:700>[</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>](</span><span style=color:#000>sycl</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>auto</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>accX</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>];</span>
</span></span><span style=display:flex><span>              <span style=color:#000>accY</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3.0</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1.0</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>0.5</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#0000cf;font-weight:700>0.3</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>));</span>
</span></span><span style=display:flex><span>           <span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}).</span><span style=color:#000>wait</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>We refer the reader to excellent freely available &ldquo;<a href=https://link.springer.com/book/10.1007%2F978-1-4842-5574-2>Data Parallel C++</a>&rdquo; book for details of this C++ snippet.</p><p>Our package <code>numba_dpex</code> allows one to write kernels in Python as well.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>numba_dpex</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@numba_dpex</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>kernel</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>numba_dpex_poly</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Y</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>numba_dpex</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get_global_id</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>X</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Y</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3.0</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1.0</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>x</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>0.5</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#0000cf;font-weight:700>0.3</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>x</span><span style=color:#000;font-weight:700>))</span>
</span></span></code></pre></div><p>Specifying the execution queue is done using Python context manager:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>numpy</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>np</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>X</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>random</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>randn</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>**</span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>Y</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>np</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>empty_like</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>with</span> <span style=color:#000>dpctl</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>device_context</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>q</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># apply the kernel to elements of X, writing value into Y, </span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># while executing using given queue</span>
</span></span><span style=display:flex><span>    <span style=color:#000>numba_dpex_poly</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>X</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>size</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>numba_dpex</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>DEFAULT_LOCAL_SIZE</span><span style=color:#000;font-weight:700>](</span><span style=color:#000>X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Y</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>The argument to <code>device_context</code> can be a queue object, a device object for which a temporary queue will be created,
or a filter selector string. Thus we could have equally used <code>dpctl.device_context(gpu_dev)</code> or <code>dpctl.device_context("gpu")</code>.</p><p>Note that in this examples data sharing was implicitly managed for us: in the case of calling a function from a precompiled
oneAPI native extension data sharing was managed by DPC++ runtime, while in the case of using <code>numba_dpex</code> kernel it was managed
during execution of <code>__call__</code> method.</p><h3 id=data-sharing>Data sharing</h3><p>Implicit data managing is surely convenient, but its use in interpreted code comes at a performance cost. A runtime must
implicitly copy data from host to the device before the kernel execution commences and then copy some (or all) of it back
after the execution completes.</p><p><code>dpctl</code> provides for allocating memory directly accessible to kernels executing on a device using SYCL&rsquo;s
Unified Shared Memory (<a href=https://www.khronos.org/registry/SYCL/specs/sycl-2020/html/sycl-2020.html#sec:usm>USM</a>) feature as well as for the <a href=https://data-apis.org/array-api/latest/>array-API</a> conforming ND-array
object <code>dpctl.tensor.usm_ndarray</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>dpctl.tensor</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>dpt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># allocate array of doubles using USM-device allocation on GPU device</span>
</span></span><span style=display:flex><span><span style=color:#000>X</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dpt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>arange</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0.</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>end</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1.0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>step</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1e-6</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>device</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;gpu&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>usm_type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;device&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># allocate array for the output</span>
</span></span><span style=display:flex><span><span style=color:#000>Y</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dpt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>empty_like</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>X</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># execution queue is inferred from allocation queues.</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Kernel is executed on the same device where arrays were allocated</span>
</span></span><span style=display:flex><span><span style=color:#000>numba_dpex_poly</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>X</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>size</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>numba_dpex</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>DEFAULT_LOCAL_SIZE</span><span style=color:#000;font-weight:700>](</span><span style=color:#000>X</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Y</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>The execution queue can be unambiguously determined in this case because both arguments are
USM arrays with the same allocation queues because <code>X.sycl_queue == Y.sycl_queue</code> evaluates to <code>True</code>.
Should the queues be different, such an inference becomes impossible and <code>numba_dpex</code> raises
<code>IndeterminateExecutionQueueError</code> advising user to explicitly migrate the data.</p><p>Migration can be accomplished either by using <code>dpctl.tensor.asarray(X, device=target_device)</code>
to create a copy, or by using <code>X.to_device(target_device)</code> method.</p><p>The result USM array can be copied back into a NumPy array using <code>dpt.asnumpy(Y)</code> if needed.</p><p><code>dpctl</code> and <code>numba_dpex</code> are both under heavy development. Feel free to file an issue on GitHub or
reach out on Gitter should you encounter any issues.</p><div class="text-muted mt-5 pt-3 border-top">Last modified June 30, 2022: <a href=https://github.com/IntelPython/oneAPI-for-SciPy/commit/5fbb564f3b9b0a110d79da255c48c2c617ec16a2>Filled out quickstart.md (5fbb564)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Gitter aria-label=Gitter><a class=text-white target=_blank rel=noopener href=https://gitter.im/Data-Parallel-Python/community aria-label=Gitter><i class="fab fa-gitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow for Intel oneAPI" aria-label="Stack Overflow for Intel oneAPI"><a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/intel-oneapi aria-label="Stack Overflow for Intel oneAPI"><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/IntelPython/ aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Intel Developer Zone" aria-label="Intel Developer Zone"><a class=text-white target=_blank rel=noopener href=https://community.intel.com/t5/Intel-Distribution-for-Python/bd-p/distribution-python aria-label="Intel Developer Zone"><i class="fas fa-hands-helping"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 Intel Corp. All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/oneAPI-for-SciPy/js/main.min.57829c4a449c0d377b7a44a808f57cbadb16a81488df2545e1739bf4e356c76d.js integrity="sha256-V4KcSkScDTd7ekSoCPV8utsWqBSI3yVF4XOb9ONWx20=" crossorigin=anonymous></script></body></html>